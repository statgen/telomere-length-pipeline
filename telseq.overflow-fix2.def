Bootstrap: library
From: ubuntu:20.04

%files

%environment
  export LC_ALL=C
  export TZ=Etc/UTC

%post
  set -eu
 
  export TZ=Etc/UTC 
  ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone

  apt-get update && apt-get -y install \
    build-essential \
    zlib1g-dev \
    libncurses5-dev \
    ca-certificates \
    gcc \
    make \
    libpq-dev \
    git \
    apt-transport-https \
    liblzma-dev \
    libbz2-dev \
    autotools-dev \
    automake \
    cmake \
    r-base r-base-dev \
    wget
  
  Rscript -e "install.packages(c('dplyr', 'readr'), repos='https://cran.us.r-project.org')"

  mkdir /build-image
  cd /build-image

  wget https://github.com/samtools/htslib/releases/download/1.4.1/htslib-1.4.1.tar.bz2
  tar xvjf htslib-1.4.1.tar.bz2
  cd htslib-1.4.1
  make
  make install
  cd ..

  wget https://github.com/samtools/samtools/releases/download/1.4.1/samtools-1.4.1.tar.bz2
  tar xvjf samtools-1.4.1.tar.bz2
  cd samtools-1.4.1
  make
  make install
  cd ..

  git clone https://github.com/pezmaster31/bamtools.git
  cd bamtools
  git checkout cbca090607f2154aa19c20ca778c3d067384b606
  mkdir build
  cd build
  cmake -DCMAKE_BUILD_TYPE=Release ..
  make
  make install
  cd ../..

  git clone https://github.com/zd1/telseq
  cd telseq
  git checkout 48c2ebcf2694a8396d96b3502a5188b9075ddba6
  cd src
  ./autogen.sh
  ./configure --with-bamtools=/usr/local
  make
  install Telseq/telseq /usr/local/bin/
  cd ../..


